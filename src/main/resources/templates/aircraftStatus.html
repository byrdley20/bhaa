<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Black Hills Aerial Adventures | Status</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<link rel="stylesheet" href="css/jqueryui/1.11.3/jquery-ui.css" />
	<link rel="stylesheet" href="css/main.css" />
    <script type="text/javascript" src="js/jquery/1.11.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/jqueryui/1.11.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/date.js"></script>
    <script th:inline="javascript">
    	/*<![CDATA[*/

		var aircraft = /*[[${aircraft}]]*/;
    	var currentHobbs = /*[[${aircraft.hobbs}+${aircraft.hobbsOffset}]]*/;
    	           
		/*]]>*/
    </script>
    <script type="text/javascript">
  		//<![CDATA[
  		           
		var lengthValidation = [];
		var passwordValidation = [];
  		           
    	$(function() {
    		var id = $( "#id" ),
    		maintenanceTypeId = $( "#maintenanceTypeId" ),
    		aircraftId = $( "#aircraftId" ),
    		complyWithHobbs = $( "#complyWithHobbs" ),
    		complyWithDate = $( "#complyWithDate" );
    		
        	allFields = $( [] ).add( id ).add( complyWithHobbs ).add( complyWithDate ).add( maintenanceTypeId ).add( aircraftId );
        	addUpdatePath = "/aircraftStatus/complyWith";
        	deletePath = "/aircraftStatus/complyWith";
    		
    		createDialog("Save");
    		
    		$( "#complyWithDate" ).datepicker();
    		
    		//lengthValidation[lengthValidation.length] = createLengthValidationObject(userId, "'ID'", 1, 15);
    		//lengthValidation[lengthValidation.length] = createLengthValidationObject(firstName, "'First Name'", 1, 100);
    		//lengthValidation[lengthValidation.length] = createLengthValidationObject(lastName, "'Last Name'", 1, 100);
    		//lengthValidation[lengthValidation.length] = createLengthValidationObject(username, "'Username'", 1, 100);
    		
    		//passwordValidation[passwordValidation.length] = createPasswordValidationObject(password, password2);
    	});
    	function setExtraValues(formData){
    		//formData["aircraftId"] = aircraft;
    	}
    	function writeCreatedRecord(savedRecord){
    		writeEditRecord(savedRecord);
    	}
    	function writeEditRecord(savedRecord){
    		var editedRow = $(".id"+savedRecord.maintenanceTypeId);
    		var tbo = editedRow.find('.tbo').html();
    		if(editedRow.find('.hobbsDue').length){
        		editedRow.find('.complyWithHobbs').html(savedRecord.complyWithHobbs);
    			var hobbsDue = Number(savedRecord.complyWithHobbs) + Number(tbo);
    			editedRow.find('.hobbsDue').html(hobbsDue);
    			editedRow.find('.remainingHours').html(Number(hobbsDue) - Number(currentHobbs));
    		} else if(editedRow.find('.dueDate').length){
        		editedRow.find('.complyWithDate').html(savedRecord.complyWithDateDisplay);
    			var complyWithDate = Date.parse(savedRecord.complyWithDateDisplay, "M/d/yyyy");
    			var dueDate = complyWithDate.addMonths(Number(tbo));
    			editedRow.find('.dueDate').html(dueDate.toString("M/d/yyyy"));
    			var remainingDays = dateDiffInDays(Date.today(), dueDate);
    			editedRow.find('.remainingDays').html(remainingDays);
    		}
    		editedRow.find('.maintenanceTypeId').html(savedRecord.maintenanceTypeId);
    		editedRow.find('.aircraftId').html(savedRecord.aircraftId);
    		editedRow.find('.id').html(savedRecord.id);
    	}
    	function populateEditForm(editLink){
    		var editSpan = $(editLink).closest('span');
			$('#addEditForm').find('#complyWithDate').show();
			$('#addEditForm').find('.complyWithDate').show();
			$('#addEditForm').find('#complyWithHobbs').show();
			$('#addEditForm').find('.complyWithHobbs').show();
			
    		if(editSpan.parent('.maint-rows-month').length) {
    			$('#addEditForm').find('#complyWithHobbs').hide();
    			$('#addEditForm').find('.complyWithHobbs').hide();
    		} else if (editSpan.parent('.maint-rows-hour').length) {
    			$('#addEditForm').find('#complyWithDate').hide();
    			$('#addEditForm').find('.complyWithDate').hide();
    		}
    		$('#addEditForm').find('#id').val(editSpan.nextAll('span.id').first().html());
    		$('#addEditForm').find('#maintenanceTypeId').val(editSpan.nextAll('span.maintenanceTypeId').first().html());
    		$('#addEditForm').find('#aircraftId').val(editSpan.nextAll('span.aircraftId').first().html());
    	}
    	//]]>
    </script>
    <style>
    	.col {
    		float: left;
    		width: 50%;
    	}
    </style>
</head>
<body th:with="currentHobbs=(${aircraft.hobbs}+${aircraft.hobbsOffset}),engineTotalTime=(${aircraft.engineTotalTime}+${aircraft.engineTotalTimeOffset}),aircraftTotalTime=(${aircraft.hobbs}+${aircraft.hobbsOffset}+${aircraft.engineTotalTime}+${aircraft.engineTotalTimeOffset})">

	<div th:replace="includes/header :: header">...</div>

	<div id="dialog-form" title="Comply With">
		<p class="validateTips"></p>
		<form id="addEditForm" action="/aircraftStatus/complyWith" method="post">
			<fieldset>
				<label for="complyWithDate" class="complyWithDate">Comply With Date</label>
				<input type="text" name="complyWithDate" id="complyWithDate" tabindex="-1" class="text ui-widget-content ui-corner-all"/>
				<label for="complyWithHobbs" class="complyWithHobbs">Comply With Hobbs</label>
				<input type="text" name="complyWithHobbs" id="complyWithHobbs" value="" class="text ui-widget-content ui-corner-all"/>
				<input type="text" name="id" id="id" class="hidden"/>
				<input type="text" name="maintenanceTypeId" id="maintenanceTypeId" class="hidden"/>
				<input type="text" name="aircraftId" id="aircraftId" class="hidden"/>
				<input type="submit" tabindex="-1" style="position:absolute; top:-1000px"/>
			</fieldset>
		</form>
	</div>

	<div th:text="${aircraft.model.name}">Model Name</div>
	<div th:text="${aircraft.aircraftNumber}">ID</div>
	<div th:text="'S/N: ' + ${aircraft.serialNum}">Serial Number</div>
	<div th:text="'Hobbs: ' + ${currentHobbs}">Hobbs</div>
	<div th:text="'Engine Total Time: ' + ${engineTotalTime}">Engine TT</div>
	<div th:text="'Aircraft Total Time: ' + ${aircraftTotalTime}">Aircraft TT</div>
	
	<div class="records-header-hour">
		<span class="complyWith"></span>
	    <span class="headerCell dataCell">Item</span>
	    <span class="headerCell dataCell">C/W</span>
	    <span class="headerCell dataCell">TBO Hours</span>
	    <span class="headerCell dataCell">Hobbs Due</span>
	    <span class="headerCell dataCell">Remaining Hours</span>
	</div>
	<div class="maint-rows-hour" th:each="maintType : ${flightHourMaintTypes}" th:classappend="|id${maintType.id}" th:with="complyWithHobbs=((${maintType.maintenanceLog}==null)?'0':${maintType.maintenanceLog.complyWithHobbs}),hobbsDue=(${complyWithHobbs}+${maintType.timeBeforeAction}),remainingHours=(${hobbsDue}-${currentHobbs})">
		<span class="complyWith"><a href="#" class="editLink" th:attr="data-id=${maintType.id}"><img border="0" alt="Comply With" src="images/repair.png" width="15" height="15"/></a></span>
		<span class="dataCell" th:text="${maintType.name}">Item Name</span>
		<span class="dataCell complyWithHobbs" th:text="${complyWithHobbs}">599.9</span>
		<span class="dataCell tbo" th:text="${maintType.timeBeforeAction}">100.0</span>
		<span class="dataCell hobbsDue" th:text="${hobbsDue}">699.9</span>
		<span class="dataCell remainingHours" th:text="${remainingHours}">29.0</span>
		<span class="id cell hidden" th:text="( (${maintType.maintenanceLog} == null)? '0' : ${maintType.maintenanceLog.id})">Hidden Maintenance Log ID</span>
		<span class="aircraftId cell hidden" th:text="${aircraft.id}">Hidden Aircraft ID</span>
		<span class="maintenanceTypeId cell hidden" th:text="${maintType.id}">Hidden Maintenace Type ID</span>
	</div>
	<br/>
	<div class="records-header-month">
		<span class="complyWith"></span>
	    <span class="headerCell dataCell">Item</span>
	    <span class="headerCell dataCell">C/W</span>
	    <span class="headerCell dataCell">TBO Months</span>
	    <span class="headerCell dataCell">Due Date</span>
	    <span class="headerCell dataCell">Remaining Days</span>
	</div>
	<div class="maint-rows-month" th:each="maintType : ${monthMaintTypes}" th:classappend="|id${maintType.id}" th:with="complyWithDate=((${maintType.maintenanceLog}==null)?'N/A':${maintType.maintenanceLog.complyWithDate}),dueDate=((${maintType.maintenanceLog}==null)?'N/A':${#dates.format(T(com.coptertours.util.DateUtil).addMonths(complyWithDate, maintType.timeBeforeAction), 'MM/dd/yy')})">
		<span class="complyWith"><a href="#" class="editLink" th:attr="data-id=${maintType.id}"><img border="0" alt="Comply With" src="images/repair.png" width="15" height="15"/></a></span>
		<span class="dataCell" th:text="${maintType.name}">Item Name</span>
		<span class="dataCell complyWithDate" th:text="((${maintType.maintenanceLog} == null)?'N/A':${#dates.format(complyWithDate, 'MM/dd/yy')})">01/01/15</span>
		<span class="dataCell tbo" th:text="${#numbers.formatInteger(maintType.timeBeforeAction,1)}">24</span>
		<span class="dataCell dueDate" th:text="${dueDate}">1/1/9999</span>
		<span class="dataCell remainingDays" th:text="((${maintType.maintenanceLog} == null)?'N/A':${T(com.coptertours.util.DateUtil).findDaysBetweenDates(today, dueDate)})">76</span>
		<span class="id cell hidden" th:text="((${maintType.maintenanceLog} == null)?'0':${maintType.maintenanceLog.id})">Hidden Maintenance Log ID</span>
		<span class="aircraftId cell hidden" th:text="${aircraft.id}">Hidden Aircraft ID</span>
		<span class="maintenanceTypeId cell hidden" th:text="${maintType.id}">Hidden Maintenace Type ID</span>
	</div>
	
</body>
</html>